(function(){"use strict";function t(){const e=document.getElementById("clock-time"),t=document.getElementById("clock-date"),n=document.getElementById("clock-weekday");if(!e||!t||!n)return;const a=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"];let s=Intl.DateTimeFormat().resolvedOptions().timeZone,i="";async function r(){try{const e=await fetch("https://worldtimeapi.org/api/ip");if(e.ok){const o=await e.json();s=o.timezone;const t=s.split("/");i=t[t.length-1].replace(/_/g," ");const n=document.getElementById("clock-timezone");n&&(n.textContent=`(${i})`)}}catch(e){console.warn("æ— æ³•è·å– IP æ—¶åŒºï¼Œä½¿ç”¨ç³»ç»Ÿé»˜è®¤æ—¶åŒº:",e)}}function o(){const o=new Date,i={timeZone:s,hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",year:"numeric",month:"numeric",day:"numeric",weekday:"short"};try{const a=new Intl.DateTimeFormat("zh-CN",i),r=a.formatToParts(o),s=e=>r.find(t=>t.type===e)?.value,c=s("hour"),l=s("minute"),d=s("second"),u=s("year"),h=s("month"),m=s("day");e.textContent=`${c}:${l}:${d}`,t.textContent=`${u}å¹´${h}æœˆ${m}æ—¥`;const f=s("weekday");n.textContent=f.replace("å‘¨","æ˜ŸæœŸ")}catch{const s=String(o.getHours()).padStart(2,"0"),i=String(o.getMinutes()).padStart(2,"0"),r=String(o.getSeconds()).padStart(2,"0");e.textContent=`${s}:${i}:${r}`;const c=o.getFullYear(),l=String(o.getMonth()+1).padStart(2,"0"),d=String(o.getDate()).padStart(2,"0");t.textContent=`${c}å¹´${l}æœˆ${d}æ—¥`;const u=a[o.getDay()];n.textContent=`æ˜ŸæœŸ${u}`}}o(),r().then(()=>{o()}),setInterval(o,1e3)}function n(){const n=document.getElementById("weather-container"),t=document.querySelector(".home-sidebar");if(!n)return;const e={city:t?.dataset.weatherCity||"Beijing",latitude:t?.dataset.weatherLatitude||"",longitude:t?.dataset.weatherLongitude||"",apiKey:t?.dataset.weatherApiKey||"",apiUrl:t?.dataset.weatherApiUrl||"",apiType:t?.dataset.weatherApiType||"openmeteo"};async function s(){try{n.innerHTML='<div class="weather-loading">åŠ è½½ä¸­...</div>';let t;e.apiType==="openmeteo"?t=await o(e.city):e.apiType==="wttr"?t=await i(e.city):e.apiKey?t=await a(e):t=await o(e.city),r(t)}catch(s){console.error("å¤©æ°”è·å–é”™è¯¯:",s);let t=s.message||"å¤©æ°”æ•°æ®è·å–å¤±è´¥",e="";t.includes("API Key")?e='å»ºè®®ï¼šåˆ‡æ¢åˆ° Open-Meteo APIï¼ˆæ— éœ€ API keyï¼‰ï¼Œåœ¨ config.toml ä¸­è®¾ç½® weatherApiType = "openmeteo"':t.includes("æœªæ‰¾åˆ°åŸå¸‚")?e="å»ºè®®ï¼šæ£€æŸ¥åŸå¸‚åç§°æ˜¯å¦æ­£ç¡®ï¼Œæˆ–å°è¯•ä½¿ç”¨è‹±æ–‡åŸå¸‚å":e="å»ºè®®ï¼šåˆ‡æ¢åˆ° Open-Meteo APIï¼ˆæ— éœ€ API keyï¼‰",n.innerHTML=`
                    <div class="weather-content">
                        <div class="weather-desc" style="color: #e74c3c; font-weight: 600;">âš ï¸ ${t}</div>
                        <div class="weather-details">
                            <div class="weather-detail-item">
                                <span>æç¤ºï¼š</span>
                                <span style="font-size: 0.75rem;">${e}</span>
                            </div>
                        </div>
                    </div>
                `}}async function o(e){const i=`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(e)}&count=1&language=zh`,s=await fetch(i);if(!s.ok)throw new Error("è·å–åŸå¸‚åæ ‡å¤±è´¥");const t=await s.json();if(!t.results||t.results.length===0)throw new Error("æœªæ‰¾åˆ°è¯¥åŸå¸‚");const{latitude:a,longitude:r}=t.results[0],c=`https://api.open-meteo.com/v1/forecast?latitude=${a}&longitude=${r}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&timezone=auto`,o=await fetch(c);if(!o.ok)throw new Error("è·å–å¤©æ°”æ•°æ®å¤±è´¥");const n=await o.json();return{temp:n.current.temperature_2m,humidity:n.current.relative_humidity_2m,windSpeed:n.current.wind_speed_10m,weatherCode:n.current.weather_code,city:t.results[0].name}}async function i(e){const s=`https://wttr.in/${encodeURIComponent(e)}?format=j1`,n=await fetch(s);if(!n.ok)throw new Error("è·å–å¤©æ°”æ•°æ®å¤±è´¥");const t=await n.json();return{temp:t.current_condition[0].temp_C,humidity:t.current_condition[0].humidity,windSpeed:parseFloat(t.current_condition[0].windspeedKmph)/3.6,desc:t.current_condition[0].lang_zh[0]?.value||t.current_condition[0].weatherDesc[0].value,city:t.nearest_area[0].areaName[0].value}}async function a(e){let s;if(e.latitude&&e.longitude)s=`${e.apiUrl||"https://api.openweathermap.org/data/2.5/weather"}?lat=${e.latitude}&lon=${e.longitude}&appid=${e.apiKey}&units=metric&lang=zh_cn`;else if(e.city)s=`${e.apiUrl||"https://api.openweathermap.org/data/2.5/weather"}?q=${e.city}&appid=${e.apiKey}&units=metric&lang=zh_cn`;else throw new Error("è¯·é…ç½®åŸå¸‚åç§°æˆ–ç»çº¬åº¦åæ ‡");const n=await fetch(s);if(!n.ok){const t=await n.json().catch(()=>({}));let e="å¤©æ°”æ•°æ®è·å–å¤±è´¥";throw n.status===401?e="API Key æ— æ•ˆï¼Œè¯·æ£€æŸ¥ config.toml ä¸­çš„ weatherApiKey":n.status===404?e=`æœªæ‰¾åˆ°ä½ç½®ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥åŸå¸‚åç§°æˆ–ç»çº¬åº¦åæ ‡`:t.message&&(e=t.message),new Error(e)}const t=await n.json();return{temp:t.main.temp,humidity:t.main.humidity,windSpeed:t.wind?.speed||0,weatherCode:t.weather[0].main,desc:t.weather[0].description,city:t.name}}function r(t){let s,o;t.weatherCode!==0[0]?(s=c(t.weatherCode),o=l(t.weatherCode)):t.desc?(s=d(t.desc),o=t.desc):(s="ğŸŒ¤ï¸",o="æœªçŸ¥");const i=Math.round(t.temp),a=t.humidity||0,r=t.windSpeed||0,u=e.city||t.city;n.innerHTML=`
                <div class="weather-content">
                    <div class="weather-main">
                        <div class="weather-temp">${i}Â°C</div>
                        <div class="weather-location-inline">${u}</div>
                        <div class="weather-icon">${s}</div>
                    </div>
                    <div class="weather-desc">${o}</div>
                    <div class="weather-details">
                        <div class="weather-detail-item">
                            <span>æ¹¿åº¦ï¼š</span>
                            <span>${a}%</span>
                        </div>
                        <div class="weather-detail-item">
                            <span>é£é€Ÿï¼š</span>
                            <span>${r.toFixed(1)} m/s</span>
                        </div>
                    </div>
                </div>
            `}function c(e){return e===0?"â˜€ï¸":e===1||e===2||e===3?"ğŸŒ¤ï¸":e===45||e===48?"ğŸŒ«ï¸":e>=51&&e<=67?"ğŸŒ§ï¸":e>=71&&e<=77?"â„ï¸":e>=80&&e<=82?"ğŸŒ§ï¸":e>=85&&e<=86?"â„ï¸":e>=95&&e<=99?"â›ˆï¸":"ğŸŒ¤ï¸"}function l(e){const t={0:"æ™´å¤©",1:"åŸºæœ¬æ™´æœ—",2:"éƒ¨åˆ†å¤šäº‘",3:"é˜´å¤©",45:"é›¾",48:"æ²‰ç§¯éœœé›¾",51:"å°é›¨",53:"ä¸­é›¨",55:"å¤§é›¨",56:"å†»é›¨",57:"å¼ºå†»é›¨",61:"å°é›¨",63:"ä¸­é›¨",65:"å¤§é›¨",66:"å†»é›¨",67:"å¼ºå†»é›¨",71:"å°é›ª",73:"ä¸­é›ª",75:"å¤§é›ª",77:"é›ªç²’",80:"å°é›¨",81:"ä¸­é›¨",82:"å¤§é›¨",85:"å°é›ª",86:"å¤§é›ª",95:"é›·æš´",96:"é›·æš´å¸¦å†°é›¹",99:"å¼ºé›·æš´å¸¦å†°é›¹"};return t[e]||"æœªçŸ¥"}function d(e){const t=e.toLowerCase();return t.includes("clear")||t.includes("æ™´")?"â˜€ï¸":t.includes("cloud")||t.includes("äº‘")?"â˜ï¸":t.includes("rain")||t.includes("é›¨")?"ğŸŒ§ï¸":t.includes("snow")||t.includes("é›ª")?"â„ï¸":t.includes("thunder")||t.includes("é›·")?"â›ˆï¸":t.includes("fog")||t.includes("é›¾")?"ğŸŒ«ï¸":"ğŸŒ¤ï¸"}s(),setInterval(s,30*60*1e3)}function s(){const f=document.querySelector(".music-widget");let s=[];if(f&&f.dataset.musicList)try{s=JSON.parse(f.dataset.musicList)}catch(e){console.error("éŸ³ä¹åˆ—è¡¨è§£æå¤±è´¥:",e)}(!s||s.length===0)&&(s=[]);const e=new Audio;e.preload="auto",e.crossOrigin="anonymous";let i=0,t=!1;const c=document.getElementById("music-title"),l=document.getElementById("music-artist"),n=document.getElementById("music-play-pause"),_=document.getElementById("music-prev"),y=document.getElementById("music-next"),h=document.getElementById("music-progress-bar"),j=document.getElementById("music-progress-fill"),v=document.getElementById("music-current-time"),r=document.getElementById("music-duration"),u=document.getElementById("music-volume"),b=document.getElementById("music-volume-value");if(!e||!n)return;function d(o){if(o<0||o>=s.length)return;i=o;const a=s[o];t&&(e.pause(),t=!1,n&&(n.textContent="â–¶")),e.src="",e.load(),e.src=a.url,c&&(c.textContent=a.title),l&&(l.textContent=a.artist||"æœªçŸ¥è‰ºæœ¯å®¶"),e.load(),O()}function O(){const e=document.querySelectorAll(".playlist-item");e.forEach((e,t)=>{t===i?e.classList.add("active"):e.classList.remove("active")})}function x(){if(t)e.pause(),n.textContent="â–¶",t=!1;else{e.readyState===0&&e.load();const s=e.play();s!==0[0]&&s.then(()=>{n.textContent="â¸",t=!0}).catch(e=>{console.error("æ’­æ”¾å¤±è´¥:",e),t=!1,n.textContent="â–¶",alert("éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥éŸ³ä¹æ–‡ä»¶æˆ–ç½‘ç»œè¿æ¥")})}}function C(){const n=i-1<0?s.length-1:i-1;d(n),t&&e.play()}function g(){const n=(i+1)%s.length;d(n),t&&e.play()}function E(){if(e.duration){const t=e.currentTime/e.duration*100;j&&(j.style.width=t+"%"),v&&(v.textContent=p(e.currentTime)),r&&(r.textContent=p(e.duration))}}function p(e){if(isNaN(e))return"0:00";const t=Math.floor(e/60),n=Math.floor(e%60);return`${t}:${String(n).padStart(2,"0")}`}n.addEventListener("click",x),_&&_.addEventListener("click",C),y&&y.addEventListener("click",g),h&&h.addEventListener("click",t=>{const n=h.getBoundingClientRect(),s=(t.clientX-n.left)/n.width;e.currentTime=s*e.duration}),u&&(u.addEventListener("input",t=>{const n=t.target.value/100;e.volume=n,b&&(b.textContent=t.target.value+"%")}),e.volume=u.value/100),e.addEventListener("timeupdate",E),e.addEventListener("ended",g),e.addEventListener("loadedmetadata",()=>{r&&(r.textContent=p(e.duration))}),e.addEventListener("error",e=>{console.error("éŸ³é¢‘åŠ è½½é”™è¯¯:",e),t&&(t=!1,n&&(n.textContent="â–¶")),alert("éŸ³é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨æˆ–ç½‘ç»œè¿æ¥")}),e.addEventListener("stalled",()=>{console.warn("éŸ³é¢‘åŠ è½½åœæ»ï¼Œå°è¯•é‡æ–°åŠ è½½"),t&&(e.load(),e.play().catch(e=>{console.error("é‡æ–°æ’­æ”¾å¤±è´¥:",e)}))}),e.addEventListener("waiting",()=>{console.log("éŸ³é¢‘ç¼“å†²ä¸­...")}),e.addEventListener("canplaythrough",()=>{console.log("éŸ³é¢‘å¯ä»¥å®Œæ•´æ’­æ”¾")}),e.addEventListener("pause",()=>{t&&e.readyState<3&&console.warn("éŸ³é¢‘æ„å¤–æš‚åœï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜")});let m=0,a=0,A=setInterval(()=>{if(t){const s=e.currentTime;if(s===m&&s>0&&!e.paused){if(a++,a>=3){console.warn("æ£€æµ‹åˆ°éŸ³é¢‘å¡ä½ï¼Œå°è¯•æ¢å¤æ’­æ”¾");const o=s,i=!e.paused;e.load(),e.addEventListener("loadeddata",function s(){e.currentTime=o,i&&e.play().catch(e=>{console.error("æ¢å¤æ’­æ”¾å¤±è´¥:",e),t=!1,n&&(n.textContent="â–¶")}),e.removeEventListener("loadeddata",s)},{once:!0}),a=0}}else a=0;m=s}else a=0,m=0},1e3);const o=document.getElementById("playlist-toggle"),w=document.getElementById("playlist-content"),k=document.querySelectorAll(".playlist-item");if(o&&w){let e=!1;o.addEventListener("click",t=>{t.stopPropagation(),e=!e,w.classList.toggle("collapsed",e),o.classList.toggle("collapsed",e),o.textContent=e?"â–¶":"â–¼"});const t=o.closest(".playlist-header");t&&t.addEventListener("click",e=>{e.target!==o&&o.click()})}k.forEach((n,s)=>{n.addEventListener("click",()=>{d(s),t&&e.play()})}),s.length>0?d(0):(c&&(c.textContent="æš‚æ— éŸ³ä¹"),l&&(l.textContent="è¯·å°† MP3 æ–‡ä»¶æ”¾å…¥ static/mp3 æ–‡ä»¶å¤¹"))}function e(){document.querySelector(".page.home")&&(t(),n(),s())}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()})()